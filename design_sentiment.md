# A股/基金市场情绪与消息深度博弈助手 (Deep Sentiment & News Analyst)

## 1. 设计理念迭代
**从“观测结果”转向“分析博弈”。**
- **旧版**：大盘涨了 -> 情绪好 -> 建议买入。（滞后，无效）
- **新版**：利好消息发布 + 板块高开低走 + 炸板率飙升 -> 情绪分歧，主力借利好出货 -> 建议防守。（预判，实战）

本设计旨在通过**微观结构数据**（涨停、炸板、龙虎榜）和**消息面深度NLP**（去噪、评级），辅助散户识别市场的真实体温。

---

## 2. 系统核心架构：三层博弈模型

我们构建三个具体的分析引擎，分别对应市场的三个维度。

### 2.1 引擎一：消息面雷达 (Event-Driven Radar)
*目标：解决“消息满天飞，不知谁真谁假”的痛点。*

*   **数据源 (Akshare)**：
    *   `stock_telegraph_cls`: 财联社电报（最快、最核心的短线消息源）。
    *   `stock_info_global_cls`: 全球财经快讯（宏观背景）。
    *   (预留) 互动易/董秘回答：用于验证“小作文”真伪。

*   **处理逻辑 (LLM)**：
    1.  **去噪**：过滤掉无意义的公告（如“召开股东大会”）、纯口水话。
    2.  **NLP 评级**：
        - **重要性 (1-5星)**：此消息是否足以驱动一个板块？
        - **情绪倾向**：利好 / 利空 / 预期兑现 / 不及预期。
    3.  **概念映射**：将新闻自动关联到具体板块（如“固态电池”、“低空经济”）。
    
*   **输出**：今日核心消息摘要，标注“强驱动”事件。

### 2.2 引擎二：情绪周期温度计 (Sentiment Cycle Thermometer)
*目标：解决“追高被套，低吸没人要”的节奏问题。通过超短数据判断市场处于周期的哪个阶段。*

*   **数据源 (Akshare)**：
    *   `stock_zt_pool_em`: **涨停池**（情绪的发动机）。
    *   `stock_zt_pool_zbgc_em`: **炸板股池**（分歧的体现）。
    *   `stock_zt_pool_previous_em`: **昨日涨停股今日表现**（赚钱效应的延续性）。
    *   `stock_zt_pool_sub_new_em`: 次新股池（最纯粹的情绪博弈）。

*   **核心指标算法**：
    1.  **封板率 (Success Rate)**：`涨停数 / (涨停数 + 炸板数)`。
        - < 60%：情绪极差，打板容易吃面（亏钱）。
        - > 80%：情绪高潮，谨防次日分歧。
    2.  **晋级率 (Promotion Rate)**：昨日首板今日连板的比例。代表资金接力的意愿。
    3.  **空间高度 (Space Height)**：当前市场最高连板数（3板？5板？7板？）。高度打开代表投机活跃。
    4.  **核按钮指数**：统计跌停家数及昨日涨停今日跌停的数量（极度恐慌指标）。

*   **周期定位 (LLM)**：
    - **启动期**：首板数量大增，新题材出现。
    - **发酵期**：前排个股一字板，后排跟风涨停，晋级率高。
    - **分歧期**：炸板率飙升，高位股放量震荡。
    - **退潮期**：高位股跌停（核按钮），连板高度压制。
    - **冰点期**：涨停家数极少，全市场普跌（往往是反转节点）。

### 2.3 引擎三：主力博弈透视 (Smart Money X-Ray)
*目标：看清是谁在买。是“家人们”（散户）在接盘，还是机构/游资在合力。*

*   **数据源 (Akshare)**：
    *   `stock_lhb_detail_em`: **龙虎榜详情**。
    *   `stock_hsgt_north_net_flow_in_em`: 北向资金实时流向。

*   **分析逻辑**：
    1.  **机构/外资席位**：代表基本面认可，趋势性强（适合中线跟）。
    2.  **知名游资席位**（如方新侠、作手新一）：代表短线爆发力，溢价高，但砸盘也快。
    3.  **散户大本营**（如拉萨天团）：代表情绪过热，往往是阶段性顶部信号（“家人们来了，快跑”）。

### 2.4 引擎四：社区舆情哨兵 (Community Sentiment Sentinel)
*目标：捕捉“散户声音”，利用“人声鼎沸是离场时”的反身性原理。*

*   **数据源 (Akshare)**：
    *   `stock_hot_rank_em`: **东方财富个股人气榜**（最直观的散户关注度指标）。

*   **分析逻辑**：
    1.  **人气过热预警 (Overheat Alert)**：
        - 某股连续 3 天霸占人气榜 Top 5，且股价处于高位（涨幅>30%），视为**情绪见顶/出货信号**。
        - *逻辑*：当所有人都在讨论这只票时，潜在买盘已经枯竭。
    2.  **新晋黑马 (Rising Star)**：
        - 排名从 100 名开外突然飙升至 Top 20。
        - *逻辑*：新题材爆发或游资点火，通常是短线**情绪启动点**。
    3.  **背离监测 (Divergence)**：
        - 股价下跌 + 人气飙升 = 散户在抄底（通常还要跌，也就是“接飞刀”）。
        - 股价上涨 + 人气低迷 = 机构悄悄买（安全区间）。

---

## 3. 落地实施步骤 (Python Modules)

### 3.1 目录结构规划
```text
src/analysis/
├── sentiment/
│   ├── __init__.py
│   ├── news_mining.py      # 消息挖掘与NLP评级
│   ├── market_cycle.py     # 涨跌停、炸板、高度板分析
│   ├── money_flow.py       # 龙虎榜与北向资金
│   ├── social_media.py     # 社区人气与舆情反指
│   └── dashboard.py        # 综合数据聚合
```

### 3.2 关键代码逻辑预览

#### A. 消息面挖掘 (news_mining.py)
```python
def analyze_news_sentiment():
    news = ak.stock_telegraph_cls()
    # 筛选近2小时的重要新闻
    # Prompt LLM: 
    # "分析这条新闻：'{content}'。
    # 1. 提取核心概念板块。
    # 2. 评分(1-5)及其对散户情绪的刺激度。
    # 3. 潜在的利好/利空方向。"
```

#### B. 情绪周期计算 (market_cycle.py)
```python
def calculate_sentiment_cycle():
    zt_pool = ak.stock_zt_pool_em(date=today)
    zb_pool = ak.stock_zt_pool_zbgc_em(date=today)
    
    # 1. 炸板率
    bomb_rate = len(zb_pool) / (len(zt_pool) + len(zb_pool))
    
    # 2. 高度板 (找出连板数最大的)
    max_height = zt_pool['连板数'].max()
    
    # 3. 昨日涨停表现 (溢价率)
    yesterday_zt = ak.stock_zt_pool_previous_em(date=today)
    premium_rate = yesterday_zt['今日涨跌幅'].mean()
    
    return {
        "bomb_rate": bomb_rate,
        "market_height": max_height,
        "money_effect": premium_rate, # 赚钱效应
        "cycle_phase": determine_phase(...) # 规则判定：启动/高潮/退潮
    }
```

---

## 4. 最终报告呈现 (Report Output)

**报告标题：【情绪实战】市场周期定位与主力风向**

**第一部分：周期定位 (The Cycle)**
> **当前状态：分歧退潮 (⚠️ 风险提示)**
> *   **炸板率**：45% (高危，大量资金被套)
> *   **最高板**：5板 (昨日7板，空间被压缩)
> *   **昨日涨停今日溢价**：-1.2% (打板客平均亏钱)
> *   **结论**：多头力竭，建议管住手，不做接力，只做低吸或空仓。

**第二部分：消息面雷达 (The News)**
> *   **固态电池 (⭐⭐⭐⭐⭐)**：宁德时代发布新技术。
>     *   *情绪预演*：板块已高潮，明日谨防利好兑现。
> *   **地产 (⭐⭐)**：某地出台新政。
>     *   *情绪预演*：老生常谈，市场反应平淡，不建议参与。

**第三部分：主力暗号 (Smart Money)**
> *   **机构买入**：中远海控 (3亿)、工业富联 (1.5亿) -> 大票趋势回暖。
> *   **游资动向**：章盟主封板某妖股，但拉萨席位接盘30%，风险巨大。

**第四部分：舆情反指 (Social Sentinel)**
> *   **高位预警**：**欧菲光** (Top 1) 连续霸榜3天，今日放量滞涨，典型“散户接盘”特征，建议止盈。
> *   **底部异动**：**万丰奥威** 人气从#120 -> #8，游资点火低空经济，关注明日弱转强机会。

---

## 5. 散户实操建议 (Actionable Advice)

*   **对于激进型**：当前炸板率过高，**空仓**是最好的防守。如果非要玩，关注首板试错，避开高位连板。
*   **对于稳健型**：机构开始回补大盘蓝筹，可关注XX板块的低吸机会。